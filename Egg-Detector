local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- ‚úÖ Egg types and pet options
local EGG_NAMES = {
    "Bug Egg", "Night Egg", "Mythical Egg", "Paradise Egg", "Oasis Egg"
}

local PET_POOL = {
    ["Bug Egg"] = {"Snail", "Caterpillar", "Giant Ant", "Dragonfly"},
    ["Night Egg"] = {"Hedgehog", "Frog", "Echo Frog", "Blood Hedgehog", "Blood Kiwi", "Mimic Octopus"},
    ["Mythical Egg"] = {"Squirrel", "Red Giant Ant", "Grey Mouse", "Red Fox"},
    ["Paradise Egg"] = {"Ostrich", "Peacock", "Capybara", "Queen Bee", "Fennec Fox"},
    ["Oasis Egg"] = {"Meercat", "Sandsnake", "Oxolotl", "Raccoon"},
}

-- üîÅ Ensure egg has a StringValue for current pet
local function ensureCurrentPet(egg)
    local sv = egg:FindFirstChild("CurrentPet")
    if not sv then
        sv = Instance.new("StringValue")
        sv.Name = "CurrentPet"
        sv.Value = ""
        sv.Parent = egg
    end
    return sv
end

-- üéØ Check if egg is near player
local function isPlayerNearby(egg)
    local part = egg:FindFirstChildWhichIsA("BasePart")
    local char = player.Character
    if not part or not char or not char:FindFirstChild("HumanoidRootPart") then return false end
    return (part.Position - char.HumanoidRootPart.Position).Magnitude <= 20
end

-- üéõÔ∏è Create UI for selecting a pet
local function updateEggUI(egg)
    local part = egg:FindFirstChildWhichIsA("BasePart")
    local currentPet = ensureCurrentPet(egg)
    if not part then return end

    if not isPlayerNearby(egg) then
        local existing = egg:FindFirstChild("PetUI")
        if existing then existing:Destroy() end
        return
    end

    local ui = egg:FindFirstChild("PetUI")
    if not ui then
        ui = Instance.new("BillboardGui")
        ui.Name = "PetUI"
        ui.Adornee = part
        ui.Size = UDim2.new(0, 200, 0, 100)
        ui.StudsOffset = Vector3.new(0, 4, 0)
        ui.AlwaysOnTop = true
        ui.Parent = egg

        local dropdown = Instance.new("TextButton")
        dropdown.Name = "Dropdown"
        dropdown.Size = UDim2.new(1, -10, 0, 30)
        dropdown.Position = UDim2.new(0, 5, 0, 5)
        dropdown.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
        dropdown.TextColor3 = Color3.new(1, 1, 1)
        dropdown.Font = Enum.Font.GothamBold
        dropdown.TextScaled = true
        dropdown.Text = "Select Pet"
        dropdown.Parent = ui

        local dropdownList = Instance.new("Frame")
        dropdownList.Name = "DropdownList"
        dropdownList.Size = UDim2.new(1, -10, 0, 60)
        dropdownList.Position = UDim2.new(0, 5, 0, 40)
        dropdownList.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        dropdownList.Visible = false
        dropdownList.ClipsDescendants = true
        dropdownList.Parent = ui

        local layout = Instance.new("UIListLayout")
        layout.FillDirection = Enum.FillDirection.Vertical
        layout.SortOrder = Enum.SortOrder.LayoutOrder
        layout.Padding = UDim.new(0, 2)
        layout.Parent = dropdownList

        dropdown.MouseButton1Click:Connect(function()
            dropdownList.Visible = not dropdownList.Visible
        end)

        -- Fill pet options
        local pool = PET_POOL[egg.Name]
        if pool then
            for _, petName in ipairs(pool) do
                local btn = Instance.new("TextButton")
                btn.Size = UDim2.new(1, 0, 0, 20)
                btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
                btn.TextColor3 = Color3.new(1, 1, 1)
                btn.Font = Enum.Font.Gotham
                btn.TextSize = 14
                btn.Text = petName
                btn.Parent = dropdownList

                btn.MouseButton1Click:Connect(function()
                    currentPet.Value = petName
                    dropdown.Text = "Pet: " .. petName
                    dropdownList.Visible = false
                end)
            end
        end
    end

    -- Update label text if needed
    local dropdown = ui:FindFirstChild("Dropdown")
    if dropdown and currentPet.Value ~= "" then
        dropdown.Text = "Pet: " .. currentPet.Value
    end
end

-- üåÄ Loop to update nearby eggs
task.spawn(function()
    while true do
        for _, egg in ipairs(Workspace:GetDescendants()) do
            if table.find(EGG_NAMES, egg.Name) then
                updateEggUI(egg)
            end
        end
        task.wait(1)
    end
end)
